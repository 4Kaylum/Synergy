{% extends "layout/base.j2" %}

{% block scripts %}
<script src="{{ static('js/guild_settings.js') }}" type="text/javascript"></script>
{% endblock %}

{% block content %}
<div class="container mt-3">

    <div class="row">
        <div class="col">
            <img class="text-center rounded mx-auto d-block" src="https://cdn.discordapp.com/icons/{{ guild.id }}/{{ guild.icon }}.png" alt="The guild icon for {{ guild.name }}" />
        </div> <!-- col -->
    </div> <!-- row -->

    <div class="row">
        <div class="col">
            <h1 class="text-center">{{ guild.name }}</h1>
        </div> <!-- col -->
    </div> <!-- row -->

    <div class="row" id="guild-settings-accordion-holder">

        <button class="btn btn-secondary w-100 mb-3 mt-3" type="button" onclick="addNewCommand();">
            Add new command
        </button>

        <div class="accordion w-100" id="guild-settings-accordion">
            {% for name, responses in interactions.items() %}
                <form class="card interaction-form" data-interaction-name="{{ name }}">

                    <div class="card-header" id="interaction-command-{{ name }}">
                        <h5 class="mb-0">
                            <button class="btn btn-link w-100" type="button" data-toggle="collapse" data-target="#collapse-interaction-command-{{ name }}" aria-expanded="true" aria-controls="collapse-interaction-command-{{ name }}">
                                {{ name }} command
                            </button>
                        </h5>
                    </div> <!-- card-header -->

                    <div id="collapse-interaction-command-{{ name }}" class="collapse show" aria-labelledby="interaction-command-{{ name }}" data-parent="#guild-settings-accordion">
                        <div class="card-body">

                            <div class="input-group">
                                <button class="btn btn-primary w-50" type="button" onclick="addNewResponse(this.parentNode.parentNode);">Add new response</button>
                                <button class="btn btn-secondary w-50" type="button" onclick="addNewResponse($(this.parentNode.parentNode.parentNode.parentNode.parentNode).remove());">Delete command</button>
                            </div>

                            {% for text in responses %}
                                <div class="input-group mt-1">
                                    <input type="text" class="form-control" placeholder="A response for an interaction" value="{{ text }}" required />
                                    <div class="input-group-append">
                                        <button class="btn btn-danger" type="button" onclick="$(this.parentNode.parentNode).remove()">-</button>
                                    </div>
                                </div>
                            {% endfor %}
                        </div> <!-- card-body -->
                    </div> <!-- collapse -->

                </form> <!-- card -->
            {% endfor %}
        </div> <!-- accordion -->

        <button class="btn btn-primary w-100 mb-3 mt-3" type="button" onclick="submitCommandChanges();">
            Submit Command Changes
        </button>

    </div> <!-- row -->

</div>
{% endblock content%}
